/* angular-busy-button - v1.0.0 by codekraft-studio - 2016-03-17 */
angular.module("angular-busy-button",[]).directive("busyButton",function($log,$timeout,$q){function changeText(elem,text){return"input"===elem[0].nodeName.toLowerCase()?elem.val(text):elem.html(text)}function _link(scope,elem,attrs){var completeClassResult,count=0,isInput="input"===elem[0].nodeName.toLowerCase(),defaultTimeout=2e3,defaultWaitTime=1e3,originalText=(isInput?elem.val():elem.text())||"Submit",busyText=attrs.busyText||"Loading..",busySuccess=attrs.busySuccess||(isInput?"Done":"&#10004;"),busyError=attrs.busyError||(isInput?"Error":"&#x2717;"),busyCompleteText=busySuccess,busyAfter=attrs.busyAfter||originalText,completeClass=attrs.busyCompleteClass||"btn-complete",busyWaitTime=attrs.busyWaitTime||defaultWaitTime,busyRuntimes=attrs.busyRuntimes||-1;angular.isFunction(scope.busyButton)?elem.bind("click",function(e){scope.$apply(function(){return scope.busyFlag=!0,$q.when(scope.busyButton(),function(response){busyCompleteText=busySuccess,completeClassResult="success"},function(){busyCompleteText=busyError,completeClassResult="error"}).then(function(){scope.busyFlag=!1})})}):elem.bind("click",function(e){scope.$apply(function(){scope.busyFlag=!0,$timeout(function(){scope.busyFlag=!scope.busyFlag},defaultTimeout)})}),scope.$watch("busyFlag",function(n,o){n!==o&&(n?(changeText(elem,busyText),elem.addClass("btn-busy"),attrs.$set("disabled",!0)):(count++,elem.removeClass("btn-busy"),elem.addClass(completeClass),elem.addClass(completeClassResult),changeText(elem,busyCompleteText),$timeout(function(){return elem.removeClass(completeClass),elem.removeClass(completeClassResult),changeText(elem,busyAfter),-1===busyRuntimes?attrs.$set("disabled",!1):busyRuntimes>count?attrs.$set("disabled",!1):void elem.addClass("btn-disabled")},busyWaitTime)))})}var _scope={busyButton:"=?"},directive={restrict:"A",scope:_scope,link:_link};return directive});