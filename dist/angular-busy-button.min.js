/* angular-busy-button - v1.1.0 by codekraft-studio - 2017-05-22 */
angular.module("angular-busy-button",[]),angular.module("angular-busy-button").directive("busyButton",function($log,$timeout,$q){function _link(scope,elem,attrs){function changeText(elem,text){return isInput?elem.val(text):elem.html(text)}var completeClassResult,count=0,isInput="input"===elem[0].nodeName.toLowerCase(),defaultTimeout=2e3,defaultWaitTime=1e3,originalText=(isInput?elem.val():elem.text())||"Submit",busyText=attrs.busyText||"Loading..",busySuccess=attrs.busySuccess||(isInput?"Done":"&#10004;"),busyError=attrs.busyError||(isInput?"Error":"&#x2717;"),busyCompleteText=busySuccess,busyAfter=attrs.busyAfter||originalText,completeClass=attrs.busyCompleteClass||"btn-complete",busyWaitTime=attrs.busyWaitTime||defaultWaitTime,busyRuntimes=attrs.busyRuntimes||-1;elem.bind("click",function(e){var promise=scope.busyButton();if("undefined"!=typeof promise&&promise){promise.then||promise.$then?promise=promise:promise.$promise?promise=promise.$promise:promise.denodeify&&(promise=$q.when(promise));var then=promise.then||promise.$then;return then?(scope.busyFlag=!0,then.call(promise,function(){busyCompleteText=busySuccess,completeClassResult="success"},function(){busyCompleteText=busyError,completeClassResult="error"}).then(function(){scope.busyFlag=!1})):void $log.warn("angular-busy-button: You passed an invalid promise:",promise)}scope.$apply(function(){scope.busyFlag=!0,$timeout(function(){scope.busyFlag=!scope.busyFlag},defaultTimeout)})}),scope.$watch("busyFlag",function(n,o){n!==o&&(n?(changeText(elem,busyText),elem.addClass("btn-busy"),attrs.$set("disabled",!0)):(count++,elem.removeClass("btn-busy"),elem.addClass(completeClass),elem.addClass(completeClassResult),changeText(elem,busyCompleteText),$timeout(function(){elem.removeClass(completeClass),elem.removeClass(completeClassResult),changeText(elem,busyAfter),busyRuntimes===-1||busyRuntimes>count?attrs.$set("disabled",!1):elem.addClass("btn-disabled")},busyWaitTime)))})}var _scope={busyButton:"&?"},directive={restrict:"A",scope:_scope,link:_link};return directive});